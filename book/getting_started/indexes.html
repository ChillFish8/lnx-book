<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Indexes - Getting started with lnx</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="An introduction to lnx covering setup, usage and optimisation.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting_started/installing.html"><strong aria-hidden="true">1.1.</strong> Installing</a></li><li class="chapter-item expanded "><a href="../getting_started/running.html"><strong aria-hidden="true">1.2.</strong> Running</a></li><li class="chapter-item expanded "><a href="../getting_started/indexes.html" class="active"><strong aria-hidden="true">1.3.</strong> Indexes</a></li><li class="chapter-item expanded "><a href="../getting_started/index_transactions.html"><strong aria-hidden="true">1.4.</strong> Index Transactions</a></li><li class="chapter-item expanded "><a href="../getting_started/documents.html"><strong aria-hidden="true">1.5.</strong> Documents</a></li><li class="chapter-item expanded "><a href="../getting_started/searching.html"><strong aria-hidden="true">1.6.</strong> Searching An Index</a></li><li class="chapter-item expanded "><a href="../getting_started/auth.html"><strong aria-hidden="true">1.7.</strong> Securing Your System</a></li><li class="chapter-item expanded "><a href="../getting_started/next_steps.html"><strong aria-hidden="true">1.8.</strong> Next Steps</a></li></ol></li><li class="chapter-item expanded "><a href="../optimising.html"><strong aria-hidden="true">2.</strong> Optimising</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Getting started with lnx</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="creating-an-index"><a class="header" href="#creating-an-index">Creating An Index</a></h1>
<p>Creating an index is fairly simple, once made lnx will it as a persistent config so that you 
dont need to continuously keep redefining it.</p>
<h3 id="endpoints-required"><a class="header" href="#endpoints-required">Endpoints Required</a></h3>
<pre><code>POST /indexes
</code></pre>
<h3 id="gotcha-moments"><a class="header" href="#gotcha-moments">Gotcha Moments</a></h3>
<p>Creating an index can create quite a few gotcha moments so its important to understand the behaviour
of the system before ramming your head into a wall wondering why things arent updating or being
destroyed.</p>
<ul>
<li>This system is append / delete only, to update an index it must be deleted and re-made, all 
data is lost in the process. This is because the index is schema-full and requires fields exist
if define (This may change in future releases.)</li>
<li>Creating indexes are <strong>VERY HEAVY</strong> operations, not only are you acquiring a global lock across
all indexes stopping anything else completing operations but you are also spawning and creating
several threads and thread pools (more on this later.) They should not be made randomly during 
usage and should not be made via some user input <em>THIS WILL CAUSE SERIOUS ISSUES OTHERWISE</em>.</li>
<li>Deleting indexes clear all data stored, this means any previously uploaded documents will be
removed.</li>
<li>The <code>max_concurrency</code> determines the amount of readers proportionally, and 
the <code>reader_threads</code> determines the amount of threads each reader gets, 
therefore you spawn at least <code>max_concurrency</code> x <code>reader_threads</code> + <code>writer_threads</code> + <code>1</code> (for writer thread)</li>
</ul>
<h3 id="support-field-data-types"><a class="header" href="#support-field-data-types">Support Field Data Types</a></h3>
<ul>
<li><code>string</code> This is similar to <code>text</code> but wont be indexed. (Supports <code>stored</code> bool)</li>
<li><code>text</code> This is similar to <code>string</code> but will be indexed. (Supports <code>stored</code> bool)</li>
<li><code>bytes</code> A arbitrary bytes field with given (Supports <a href="/getting_started/creating_a_index.html#bytes-options">BytesOptions</a>)</li>
<li><code>f64</code> A 64 bit floating point integer field. (Supports <a href="/getting_started/creating_a_index.html#int-options">IntOptions</a>)</li>
<li><code>i64</code> A 64 bit signed integer field. (Supports <a href="/getting_started/creating_a_index.html#int-options">IntOptions</a>)</li>
<li><code>u64</code> A 64 bit unsigned point integer field. (Supports <a href="/getting_started/creating_a_index.html#int-options">IntOptions</a>)</li>
<li><code>date</code> A UTC datetime field, stored as a u64 integer. (Supports <a href="/getting_started/creating_a_index.html#int-options">IntOptions</a>)</li>
</ul>
<h4 id="int-options"><a class="header" href="#int-options">Int Options</a></h4>
<p>If a field is <em>in italic</em> it's optional and not required.</p>
<ul>
<li>
<p><code>indexed</code>: bool - Whether or not to index this field. 
Setting an integer as indexed will generate a posting list for each value taken by the integer.</p>
</li>
<li>
<p><em><code>fast</code>: 'single' or 'multi'</em> - Set the field as a fast field with a
given cardinality which makes it either a single-value or multi-value field. 
Fast fields are designed for random access.
Access time are similar to a random lookup in an array.
If more than one value is associated to a fast field, only the last one is kept.</p>
</li>
<li>
<p><code>stored</code>: bool - Set the field as stored.
Only the fields that are set as <em>stored</em> are persisted into the store.</p>
</li>
</ul>
<h4 id="bytes-options"><a class="header" href="#bytes-options">Bytes Options</a></h4>
<p>If a field is <em>in italic</em> it's optional and not required.</p>
<ul>
<li>
<p><code>indexed</code>: bool - Whether or not to index this field. 
Setting an integer as indexed will generate a posting list for each value taken by the integer.</p>
</li>
<li>
<p><em><code>fast</code>: bool</em> - Set the field as a single-valued fast field. 
Fast fields are designed for random access.
Access time are similar to a random lookup in an array.
If more than one value is associated to a fast field, only the last one is kept.</p>
</li>
<li>
<p><code>stored</code>: bool - Set the field as stored.
Only the fields that are set as <em>stored</em> are persisted into the store.</p>
</li>
</ul>
<h3 id="the-request-payload"><a class="header" href="#the-request-payload">The Request Payload</a></h3>
<p>The <code>/indexes</code> endpoint expects a POST request with a <code>application/json</code> body, and example 
payload looks like:</p>
<pre><code class="language-js">{
    &quot;name&quot;: &quot;my-index&quot;,  // The name of the index, must not contain '/'

    &quot;writer_buffer&quot;: 6000000,  // The buffer size in bytes for the writer to use.
    &quot;writer_threads&quot;: 1,    // The number of threads for the index writer to use.

    &quot;reader_threads&quot;: 1,   // The number of threads for each reader to use. 
    
    &quot;max_concurrency&quot;: 10,  // The maximum amount of searches / readers at one time.
    &quot;search_fields&quot;: [   // The list of fields that are used when searching.
        &quot;title&quot; 
    ],
    
    // The backend to use, choices of 'memory', 'tempdir', and 'filesystem'
    &quot;storage_type&quot;: {   
        &quot;mode&quot;: &quot;memory&quot;,
        // if we were using 'filesystem' then we would need to give a path.
        // &quot;path&quot;: &quot;/store&quot;,
    },  
    
    // The actual fields for this schema.
    // NOTE: not every field defined is used to search.
    &quot;fields&quot;: {   
        &quot;title&quot;: {
            // We defined the field type as `text` this means it will be indexed.
            &quot;type&quot;: &quot;text&quot;,   
          
            // This will be stored, compressed and returned when returning data.
            &quot;stored&quot;: true,   
        },
        &quot;description&quot;: {
           &quot;type&quot;: &quot;text&quot;,  
           &quot;stored&quot;: true,
        },
        &quot;id&quot;: {
            // Types supported include: u64, i64, f64, date, text, string, bytes
            &quot;type&quot;: &quot;u64&quot;,    
    
            // Optionally if true this will be indexed (Only for int fields and date)
            &quot;indexed&quot;: true,  
            &quot;stored&quot;: true,   
  
            // Integer fields can be defined as fast fields, this allows us to apply
            // some additional optimisations by telling tantivy if it's a single value
            // or multi-value field.
            &quot;fast&quot;: &quot;single&quot;, 
        },    
    },
    
    // Boost fields are what we can use to adjust how much weight we give to
    // specific fields to adjust how much bias there is to each field.
    &quot;boost_fields&quot;: {   
      &quot;title&quot;: 2.0,     
      &quot;description&quot;: 0.8,
    }
}
</code></pre>
<h3 id="success"><a class="header" href="#success">Success!</a></h3>
<p>Providing the given payload data is valid you have successfully made an index.</p>
<p>This can error if you assign more threads than your system can reasonably assign.</p>
<h3 id="performance-note"><a class="header" href="#performance-note">Performance Note</a></h3>
<p>More threads != faster, you should test and benchmark different ratios of reader threads
and concurrency as that will have the biggest affect on performance.</p>
<h3 id="deleting-an-index"><a class="header" href="#deleting-an-index">Deleting An Index</a></h3>
<p>An index can be deleted via sending a request to the following endpoint:</p>
<pre><code>DELETE /indexes/:index_name
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../getting_started/running.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../getting_started/index_transactions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../getting_started/running.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../getting_started/index_transactions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
